<!DOCTYPE html>
<!--
ğŸ åœ†åœ†å°æ±¤åœ†çš„è¶…çº§å„¿ç«¥èŠ‚æƒŠå–œ ğŸˆ

âœ¨ è¿™æ˜¯ä¸€ä»½ç‰¹åˆ«åˆ¶ä½œçš„äº’åŠ¨ä½“éªŒé¡µé¢ï¼ŒåŒ…å«ï¼š
   â€¢ çˆ±å¿ƒæ˜Ÿåº§æ‹¼å›¾ - ç‚¹äº®ä¸“å±æ˜Ÿç©º
   â€¢ æ—¶å…‰éš§é“ - å›å¿†ç¾å¥½ç¬é—´  
   â€¢ ä¸“å±å°æµ‹è¯• - äº†è§£å½¼æ­¤çš„æ¸¸æˆ
   â€¢ å¹¸è¿ç­¾æŠ½å– - è·å¾—ä¸“å±ç¥ç¦
   â€¢ å¿ƒæ„¿æ”¶é›†ç›’ - è®¸ä¸‹ç¾å¥½å¿ƒæ„¿
   â€¢ éŸ³ä¹ç›’ä½“éªŒ - è§†å¬ç››å®´
   â€¢ è¿˜æœ‰æ›´å¤šç²¾å½©äº’åŠ¨...

ğŸ’¡ æœ€ä½³ä½“éªŒæ–¹å¼ï¼š
   1. ä¿å­˜åˆ°æ‰‹æœºç›¸å†Œæˆ–æ–‡ä»¶ç®¡ç†å™¨
   2. ç”¨æµè§ˆå™¨æ‰“å¼€ï¼ˆæ¨èChromeã€Safariï¼‰
   3. å…¨å±ä½“éªŒï¼Œå»ºè®®ä½©æˆ´è€³æœº
   4. ä½“éªŒæ—¶é—´çº¦10-15åˆ†é’Ÿ

ğŸ’– ä¸“å±å®šåˆ¶ by ä¸€ä¸ªæƒ³è®©ä½ å¼€å¿ƒçš„æœ‹å‹
-->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- ç½‘é¡µæ ‡é¢˜å’Œæè¿° -->
    <title>ğŸ’– åœ†åœ†å°æ±¤åœ†çš„è¶…çº§å„¿ç«¥èŠ‚æƒŠå–œ - ä¸“å±æµªæ¼«ä½“éªŒ ğŸˆ</title>
    <meta name="description" content="ğŸŒŸ ä¸€ä»½ç‰¹åˆ«ä¸ºåœ†åœ†å°æ±¤åœ†å‡†å¤‡çš„å„¿ç«¥èŠ‚æƒŠå–œï¼åŒ…å«11ä¸ªç²¾å¿ƒè®¾è®¡çš„äº’åŠ¨ç¯èŠ‚ï¼šçˆ±å¿ƒæ˜Ÿåº§æ‹¼å›¾ã€æ—¶å…‰éš§é“ã€ä¸“å±æµ‹è¯•ã€å¹¸è¿ç­¾æŠ½å–ã€å¿ƒæ„¿æ”¶é›†ç­‰ã€‚æ»¡æ»¡çš„çˆ±æ„ä¸ç«¥è¶£ï¼Œç­‰ä½ æ¥ä½“éªŒè¿™åœºä¸“å±çš„é­”æ³•ä¹‹æ—…ï¼">
    <meta name="keywords" content="å„¿ç«¥èŠ‚æƒŠå–œ,çˆ±å¿ƒæ˜Ÿåº§,æµªæ¼«ä½“éªŒ,åœ†åœ†å°æ±¤åœ†,äº’åŠ¨æ¸¸æˆ,å¿ƒæ„¿æ”¶é›†,ç«¥è¶£,ä¸“å±å®šåˆ¶">
    <meta name="author" content="ä¸€ä¸ªæƒ³è®©ä½ å¼€å¿ƒçš„å¤§æœ‹å‹ ğŸŒ¸">
    
    <!-- ç¤¾äº¤åˆ†äº«æ ‡ç­¾ (Open Graph) -->
    <meta property="og:title" content="ğŸ’– åœ†åœ†å°æ±¤åœ†çš„è¶…çº§å„¿ç«¥èŠ‚æƒŠå–œ">
    <meta property="og:description" content="ğŸŒŸ ä¸€åœºä¸“å±çš„é­”æ³•ä¹‹æ—…ç­‰ä½ æ¥ä½“éªŒï¼åŒ…å«çˆ±å¿ƒæ˜Ÿåº§æ‹¼å›¾ã€æ—¶å…‰éš§é“ã€ä¸“å±å°æµ‹è¯•ã€å¹¸è¿ç­¾æŠ½å–ã€å¿ƒæ„¿æ”¶é›†ç­‰11ä¸ªç²¾å¿ƒè®¾è®¡çš„äº’åŠ¨ç¯èŠ‚ã€‚æ„¿è¿™ä»½ç«¥è¶£ä¸çˆ±æ„èƒ½è®©ä½ å¼€å¿ƒ~ ğŸˆ">
    <meta property="og:type" content="website">
    <meta property="og:image" content="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNjY3ZWVhO3N0b3Atb3BhY2l0eToxIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjUwJSIgc3R5bGU9InN0b3AtY29sb3I6Izc2NGJhMjtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojZjA5M2ZiO3N0b3Atb3BhY2l0eToxIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmFkaWVudCkiLz4KICA8Y2lyY2xlIGN4PSIyNTYiIGN5PSIyMDAiIHI9IjgwIiBmaWxsPSJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMykiLz4KICA8dGV4dCB4PSIyNTYiIHk9IjIyMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjY0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+8J+OgTwvdGV4dD4KICA8dGV4dCB4PSIyNTYiIHk9IjMwMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjI4IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPuWEv+erleiFjue+heWWnzwvdGV4dD4KICA8dGV4dCB4PSIyNTYiIHk9IjM0MCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjIwIiBmaWxsPSJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOSkiIHRleHQtYW5jaG9yPSJtaWRkbGUiPuWchuWchuWwj+axpOWcs+eahOS4k+WxnuaDiuWWnSDwn46IPC90ZXh0Pgo8L3N2Zz4=">
    <meta property="og:url" content="">
    <meta property="og:site_name" content="åœ†åœ†å°æ±¤åœ†çš„ä¸“å±æƒŠå–œç©ºé—´">
    
    <!-- å¾®ä¿¡åˆ†äº«å’Œç§»åŠ¨ç«¯ä¼˜åŒ– -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ğŸ’–åœ†åœ†å°æ±¤åœ†çš„æƒŠå–œ">
    <meta name="application-name" content="å„¿ç«¥èŠ‚ä¸“å±æƒŠå–œ">
    
    <!-- ç½‘é¡µå›¾æ ‡å¥—è£… -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0icGFpbnQwX2xpbmVhcl8wXzEiIHgxPSIwIiB5MT0iMCIgeDI9IjMyIiB5Mj0iMzIiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N0VFQSIvPgo8c3RvcCBvZmZzZXQ9IjAuNSIgc3RvcC1jb2xvcj0iIzc2NEJBMiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNGMDkzRkIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI4IiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfMF8xKSIvPgo8dGV4dCB4PSIxNiIgeT0iMjIiIGZvbnQtZmFtaWx5PSJzeXN0ZW0tdWksIC1hcHBsZS1zeXN0ZW0sIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn46BPC90ZXh0Pgo8L3N2Zz4K">
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfMF8xIiB4MT0iMCIgeTE9IjAiIHgyPSIxODAiIHkyPSIxODAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N0VFQSIvPgo8c3RvcCBvZmZzZXQ9IjAuNSIgc3RvcC1jb2xvcj0iIzc2NEJBMiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNGMDkzRkIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8cmVjdCB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgcng9IjQwIiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfMF8xKSIvPgo8Y2lyY2xlIGN4PSI5MCIgY3k9IjcwIiByPSIyNSIgZmlsbD0icmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpIi8+Cjx0ZXh0IHg9IjkwIiB5PSI4NSIgZm9udC1mYW1pbHk9InN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfjoE8L3RleHQ+Cjx0ZXh0IHg9IjkwIiB5PSIxMjAiIGZvbnQtZmFtaWx5PSJzeXN0ZW0tdWksIC1hcHBsZS1zeXN0ZW0sIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9InJnYmEoMjU1LCAyNTUsIDI1NSwgMC45KSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPuWEv+erleiFjue+heWWnzwvdGV4dD4KPHRleHQgeD0iOTAiIHk9IjE0MCIgZm9udC1mYW1pbHk9InN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgZmlsbD0icmdiYSgyNTUsIDI1NSwgMjU1LCAwLjgpIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7lnIblnIvlsI/msaTlnIvnmoTkuJPlsZ7mgqjllZ08L3RleHQ+Cjwvc3ZnPgo=">
    
    <!-- ä¸»é¢˜è‰²å½©å’Œæ ·å¼ -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-TileImage" content="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQ0IiBoZWlnaHQ9IjE0NCIgdmlld0JveD0iMCAwIDE0NCAxNDQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNDQiIGhlaWdodD0iMTQ0IiBmaWxsPSIjNjY3RUVBIi8+Cjx0ZXh0IHg9IjcyIiB5PSI4OCIgZm9udC1mYW1pbHk9InN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI1NiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfjoE8L3RleHQ+Cjwvc3ZnPgo=">
    
    <!-- é¢„åŠ è½½å…³é”®èµ„æº -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- ç‰¹æ®Šæ ‡è®°ï¼Œè®©å¾®ä¿¡è¯†åˆ«è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šé¡µé¢ -->
    <meta name="format-detection" content="telephone=no">
    <meta name="x5-page-mode" content="app">
    <meta name="browsermode" content="application">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            touch-action: manipulation;
        }
        
        /* èƒŒæ™¯è£…é¥° */
        .background-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .floating-element {
            position: absolute;
            font-size: clamp(16px, 4vw, 24px);
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* é˜¶æ®µé€šç”¨æ ·å¼ */
        .stage {
            display: none;
            width: 100%;
            max-width: 400px;
            animation: fadeIn 0.8s ease-in;
        }
        
        .stage.active {
            display: block;
        }
        
        .stage-title {
            color: white;
            font-size: clamp(1.5em, 6vw, 2.2em);
            font-weight: 800;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            line-height: 1.2;
        }
        
        .stage-instruction {
            color: white;
            font-size: clamp(1em, 4vw, 1.2em);
            margin-bottom: 25px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            line-height: 1.4;
        }
        
        /* ç¬¬1é˜¶æ®µï¼šåŠ è½½åŠ¨ç”» */
        .loading-stage {
            display: block;
        }
        
        .loading-circle {
            width: 120px;
            height: 120px;
            border: 6px solid rgba(255,255,255,0.3);
            border-top: 6px solid #ffd93d;
            border-radius: 50%;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            font-size: 1.2em;
            margin-top: 20px;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        /* ç¬¬2é˜¶æ®µï¼šèº«ä»½éªŒè¯ */
        .quiz-container {
            background: rgba(255,255,255,0.15);
            padding: 30px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            margin: 20px 0;
        }
        
        .quiz-question {
            color: white;
            font-size: 1.3em;
            margin-bottom: 25px;
            font-weight: 600;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .quiz-option {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }
        
        .quiz-option:hover, .quiz-option:active {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }
        
        /* ç¬¬3é˜¶æ®µï¼šç¤¼ç‰©ç›’ */
        .gift-box {
            width: clamp(150px, 40vw, 200px);
            height: clamp(150px, 40vw, 200px);
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border-radius: 20px;
            position: relative;
            margin: 20px auto;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: bounce 2s ease-in-out infinite;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        }
        
        .gift-bow {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: clamp(40px, 12vw, 60px);
            height: clamp(40px, 12vw, 60px);
            background: #ffd93d;
            border-radius: 50% 50% 0 0;
        }
        
        .gift-bow::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: clamp(120px, 35vw, 160px);
            background: #ffd93d;
        }
        
        .gift-bow::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: clamp(50px, 15vw, 80px);
            height: 3px;
            background: #ffd93d;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }
        
        /* ç¬¬4é˜¶æ®µï¼šæ˜Ÿç©º */
        .starry-sky {
            width: 100%;
            min-height: 300px;
            background: radial-gradient(circle, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border-radius: 20px;
            position: relative;
            margin: 20px 0;
            padding: 30px 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }
        
        .constellation-hint {
            color: rgba(255, 255, 255, 0.8);
            font-size: clamp(12px, 3vw, 14px);
            text-align: center;
            margin-bottom: 20px;
            animation: hintPulse 2s ease-in-out infinite;
        }
        
        @keyframes hintPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        .constellation-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .constellation-line {
            stroke: #ffd93d;
            stroke-width: 2;
            stroke-dasharray: 0;
            stroke-dashoffset: 0;
            opacity: 0;
            filter: drop-shadow(0 0 8px #ffd93d);
            transition: all 0.8s ease;
        }
        
        .constellation-line.active {
            opacity: 0.8;
            stroke-dasharray: 1000;
            animation: drawLine 1.5s ease-in-out forwards;
        }
        
        @keyframes drawLine {
            from { stroke-dashoffset: 1000; }
            to { stroke-dashoffset: 0; }
        }
        
        .star {
            position: absolute;
            width: clamp(25px, 8vw, 35px);
            height: clamp(25px, 8vw, 35px);
            color: #666;
            font-size: clamp(20px, 6vw, 30px);
            cursor: pointer;
            transition: all 0.5s ease;
            user-select: none;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(102, 102, 102, 0.2);
            border-radius: 50%;
            border: 2px solid transparent;
        }
        
        .star::after {
            content: attr(data-number);
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(10px, 2.5vw, 12px);
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
        }
        
        .star.next {
            color: rgba(255, 211, 61, 0.7);
            border-color: rgba(255, 211, 61, 0.5);
            animation: starPulse 1.5s ease-in-out infinite;
            transform: scale(1.1);
        }
        
        .star.lit {
            color: #ffd93d;
            text-shadow: 0 0 20px #ffd93d;
            border-color: #ffd93d;
            background: rgba(255, 211, 61, 0.1);
            animation: starGlow 2s ease-in-out infinite;
            transform: scale(1.2);
        }
        
        @keyframes starPulse {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(255, 211, 61, 0.3);
                transform: scale(1.1);
            }
            50% { 
                box-shadow: 0 0 25px rgba(255, 211, 61, 0.6);
                transform: scale(1.15);
            }
        }
        
        @keyframes starGlow {
            0%, 100% { 
                text-shadow: 0 0 20px #ffd93d;
                box-shadow: 0 0 20px rgba(255, 211, 61, 0.6);
            }
            50% { 
                text-shadow: 0 0 30px #ffd93d, 0 0 40px #ffd93d;
                box-shadow: 0 0 40px rgba(255, 211, 61, 0.8);
            }
        }
        
        .heart-complete {
            animation: heartComplete 2s ease-in-out;
        }
        
        @keyframes heartComplete {
            0% { filter: brightness(1); }
            50% { filter: brightness(1.5) drop-shadow(0 0 30px #ff69b4); }
            100% { filter: brightness(1.2) drop-shadow(0 0 20px #ff69b4); }
        }
        
        .magic-sparkle {
            position: absolute;
            color: #ffd93d;
            font-size: clamp(12px, 3vw, 16px);
            pointer-events: none;
            animation: sparkle 2s ease-out forwards;
        }
        
        @keyframes sparkle {
            0% { 
                opacity: 0;
                transform: scale(0) rotate(0deg);
            }
            30% { 
                opacity: 1;
                transform: scale(1.2) rotate(180deg);
            }
            100% { 
                opacity: 0;
                transform: scale(0.8) rotate(360deg) translateY(-30px);
            }
        }
        
        /* å¿ƒæ„¿å°å°é­”æ³•åŠ¨ç”» */
        @keyframes sealMagic {
            0% { 
                opacity: 0;
                transform: scale(0) rotate(0deg);
            }
            50% { 
                opacity: 1;
                transform: scale(1.3) rotate(180deg);
            }
            100% { 
                opacity: 0;
                transform: scale(0.5) rotate(360deg) translate(0, -50px);
            }
        }
        
        .star-message {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 16px;
            border-radius: 15px;
            color: #333;
            font-weight: 600;
            font-size: clamp(12px, 3.5vw, 16px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.5s ease;
            z-index: 100;
            max-width: 200px;
            text-align: center;
        }
        
        .star-message.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* ç¬¬5é˜¶æ®µï¼šæ—¶å…‰éš§é“ */
        .time-tunnel {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 20px;
            padding: 30px 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .memory-card {
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            transform: scale(0);
            transition: all 0.5s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .memory-card.show {
            transform: scale(1);
            animation: cardFloat 0.8s ease-out;
        }
        
        @keyframes cardFloat {
            0% { transform: scale(0) translateY(50px); }
            50% { transform: scale(1.05) translateY(-10px); }
            100% { transform: scale(1) translateY(0); }
        }
        
        .memory-text {
            color: #333;
            font-size: clamp(14px, 4vw, 18px);
            font-weight: 600;
            line-height: 1.6;
        }
        
        /* ç¬¬6é˜¶æ®µï¼šå°æµ‹è¯• */
        .test-container {
            background: rgba(255,255,255,0.1);
            padding: 25px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .test-progress {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .test-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffd93d, #ff6b6b);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }
        
        /* ç¬¬7é˜¶æ®µï¼šå¹¸è¿ç­¾ */
        .candy-jar {
            width: clamp(120px, 30vw, 150px);
            height: clamp(150px, 35vw, 180px);
            background: linear-gradient(to bottom, #ff9a9e 0%, #fecfef 100%);
            border-radius: 60px 60px 20px 20px;
            margin: 20px auto;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .fortune-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            transform: scale(0);
            transition: all 0.5s ease;
            border: 3px solid #ff6b6b;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .fortune-card.show {
            transform: scale(1);
            animation: cardPop 0.8s ease-out;
        }
        
        @keyframes cardPop {
            0% { transform: scale(0) rotate(-10deg); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        /* ç¬¬8é˜¶æ®µï¼šå¿ƒæ„¿æ”¶é›†ç›’ */
        .wish-box {
            background: rgba(255,255,255,0.1);
            padding: 30px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .wish-input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            background: rgba(255,255,255,0.9);
            margin: 15px 0;
            text-align: center;
            font-family: inherit;
        }
        
        .wish-submit {
            background: linear-gradient(45deg, #ffd93d, #ff6b6b);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        /* ç¬¬9é˜¶æ®µï¼šè¯ä¹¦ */
        .certificate {
            background: linear-gradient(45deg, #fff9c4, #fff);
            border: 6px solid #ffd93d;
            border-radius: 20px;
            padding: 25px 20px;
            margin: 20px 0;
            position: relative;
            transform: scale(0);
            transition: all 0.8s ease;
        }
        
        .certificate.show {
            transform: scale(1);
            animation: certificateAppear 1.2s ease-out;
        }
        
        @keyframes certificateAppear {
            0% { transform: scale(0) rotate(-5deg); opacity: 0; }
            50% { transform: scale(1.05) rotate(2deg); opacity: 0.8; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .certificate-title {
            color: #ff6b6b;
            font-size: clamp(1.2em, 5vw, 1.6em);
            font-weight: 800;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }
        
        /* ç¬¬10é˜¶æ®µï¼šéŸ³ä¹ç›’ */
        .music-box {
            background: rgba(255,255,255,0.15);
            padding: 30px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .music-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .music-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .music-btn:hover, .music-btn:active {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }
        
        /* éŸ³ä¹å¯è§†åŒ–æ•ˆæœ */
        .music-visualization {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .music-visualization.playing {
            opacity: 1;
        }
        
        .music-note {
            position: absolute;
            font-size: clamp(20px, 5vw, 30px);
            color: rgba(255, 255, 255, 0.8);
            animation: floatNote 3s ease-in-out infinite;
        }
        
        @keyframes floatNote {
            0% { transform: translateY(100px) scale(0.5); opacity: 0; }
            50% { transform: translateY(-20px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-100px) scale(0.8); opacity: 0; }
        }
        
        .music-lyrics {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            color: #333;
            font-size: clamp(14px, 4vw, 16px);
            line-height: 1.8;
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .music-lyrics.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .lyric-line {
            margin: 10px 0;
            opacity: 0;
            animation: fadeInLyric 1s ease-in-out forwards;
        }
        
        @keyframes fadeInLyric {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .music-status {
            color: white;
            margin: 15px 0;
            font-size: clamp(16px, 4vw, 18px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .music-status.show {
            opacity: 1;
        }
        
        /* ç¬¬11é˜¶æ®µï¼šæœ€ç»ˆä¿¡ä»¶ */
        .final-letter {
            background: rgba(255,255,255,0.95);
            padding: 30px 25px;
            border-radius: 20px;
            color: #333;
            line-height: 1.8;
            font-size: clamp(14px, 4vw, 16px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            transform: scale(0);
            transition: all 1s ease;
        }
        
        .final-letter.show {
            transform: scale(1);
            animation: letterUnfold 1.5s ease-out;
        }
        
        @keyframes letterUnfold {
            0% { transform: scale(0.8) rotateY(90deg); opacity: 0; }
            50% { transform: scale(1.05) rotateY(45deg); opacity: 0.5; }
            100% { transform: scale(1) rotateY(0deg); opacity: 1; }
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .continue-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: clamp(14px, 4vw, 18px);
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
            touch-action: manipulation;
        }
        
        .continue-btn:hover, .continue-btn:active {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }
        
        .continue-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* é€šç”¨åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container { padding: 10px; }
            .stage { max-width: 95vw; }
            .quiz-container, .test-container, .wish-box, .music-box { padding: 20px 15px; }
            .starry-sky { min-height: 250px; padding: 20px 15px; }
            .certificate { padding: 20px 15px; }
            .final-letter { padding: 25px 20px; }
        }
        
        @media (max-height: 600px) {
            .container { justify-content: flex-start; padding-top: 20px; }
            .stage-title { margin-bottom: 15px; }
            .stage-instruction { margin-bottom: 20px; }
        }
        
        /* èƒŒæ™¯éŸ³ä¹æ§åˆ¶å™¨ */
        .music-controller {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .music-controller:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .music-toggle {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .music-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }
        
        .volume-control {
            width: 60px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }
        
        .volume-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffd93d, #ff6b6b);
            border-radius: 2px;
            width: 70%;
            transition: width 0.3s ease;
        }
        
        .music-note-indicator {
            color: rgba(255,255,255,0.8);
            font-size: 16px;
            animation: noteFloat 2s ease-in-out infinite;
        }
        
        @keyframes noteFloat {
            0%, 100% { transform: translateY(0px); opacity: 0.8; }
            50% { transform: translateY(-3px); opacity: 1; }
        }
        
        /* éŸ³é¢‘å¯è§†åŒ–æŒ‡ç¤ºå™¨ */
        .audio-waves {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .wave {
            width: 2px;
            background: linear-gradient(to top, #ffd93d, #ff6b6b);
            border-radius: 1px;
            animation: wave 1.5s ease-in-out infinite;
        }
        
        .wave:nth-child(1) { height: 8px; animation-delay: 0s; }
        .wave:nth-child(2) { height: 12px; animation-delay: 0.1s; }
        .wave:nth-child(3) { height: 6px; animation-delay: 0.2s; }
        .wave:nth-child(4) { height: 10px; animation-delay: 0.3s; }
        .wave:nth-child(5) { height: 8px; animation-delay: 0.4s; }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); opacity: 0.7; }
            50% { transform: scaleY(1.2); opacity: 1; }
        }
        
        .audio-waves.paused .wave {
            animation-play-state: paused;
        }
    </style>
</head>
<body>
    <!-- å¦‚æœç”¨æˆ·ç›´æ¥æ‰“å¼€æ–‡ä»¶ï¼Œæ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ -->
    <script>
        // æ£€æŸ¥æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡æ‰“å¼€
        if (!sessionStorage.getItem('welcomed')) {
            sessionStorage.setItem('welcomed', 'true');
            
            // åˆ›å»ºæ¬¢è¿å¼¹çª—
            setTimeout(() => {
                const welcomeDiv = document.createElement('div');
                welcomeDiv.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 20px;
                `;
                
                welcomeDiv.innerHTML = `
                    <div style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
                        padding: 30px;
                        border-radius: 20px;
                        text-align: center;
                        max-width: 350px;
                        color: white;
                        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                    ">
                        <div style="font-size: 3em; margin-bottom: 15px;">ğŸ</div>
                        <h2 style="margin: 0 0 15px 0; font-size: 1.3em;">æ¬¢è¿æ¥åˆ°ä¸“å±æƒŠå–œç©ºé—´ï¼</h2>
                        <p style="margin: 0 0 20px 0; line-height: 1.6; font-size: 0.95em;">
                            è¿™æ˜¯ä¸€ä»½ç‰¹åˆ«ä¸ºåœ†åœ†å°æ±¤åœ†å‡†å¤‡çš„å„¿ç«¥èŠ‚æƒŠå–œä½“éªŒ~<br>
                            <span style="opacity: 0.9;">åŒ…å«11ä¸ªç²¾å¿ƒè®¾è®¡çš„äº’åŠ¨ç¯èŠ‚</span>
                        </p>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            background: rgba(255,255,255,0.2);
                            border: 2px solid white;
                            color: white;
                            padding: 12px 25px;
                            border-radius: 25px;
                            font-size: 1em;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                            å¼€å§‹é­”æ³•ä¹‹æ—… âœ¨
                        </button>
                    </div>
                `;
                
                document.body.appendChild(welcomeDiv);
            }, 1000);
        }
    </script>
    
    <!-- èƒŒæ™¯éŸ³ä¹æ§åˆ¶å™¨ -->
    <div class="music-controller" id="musicController">
        <button class="music-toggle" id="bgMusicToggle" onclick="toggleBackgroundMusic()">ğŸµ</button>
        <div class="volume-control" id="volumeControl" onclick="adjustVolume(event)" ontouchstart="adjustVolumeTouch(event)">
            <div class="volume-bar" id="volumeBar"></div>
        </div>
        <div class="audio-waves" id="audioWaves">
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
        </div>
        <div class="music-note-indicator">â™ª</div>
    </div>
    
    <!-- èƒŒæ™¯éŸ³é¢‘å…ƒç´  -->
    <audio id="backgroundMusic" loop preload="auto" style="display: none;">
        <!-- æ¨èçš„å„¿ç«¥èŠ‚ä¸»é¢˜èƒŒæ™¯éŸ³ä¹ï¼ˆæ‚¨å¯ä»¥æ›¿æ¢ä¸ºè‡ªå·±çš„éŸ³ä¹æ–‡ä»¶ï¼‰ -->
        <!-- 
        é€‚åˆçš„éŸ³ä¹ç±»å‹ï¼š
        1. è½»æŸ”çš„é’¢ç´æ›² - å¦‚ã€Šå¤©ç©ºä¹‹åŸã€‹é’¢ç´ç‰ˆ
        2. æ¸©é¦¨çš„éŸ³ä¹ç›’æ—‹å¾‹ - å¦‚ã€ŠTwinkle Twinkle Little Starã€‹
        3. å„¿ç«¥èŠ‚ç»å…¸æ­Œæ›²çº¯éŸ³ä¹ç‰ˆ - å¦‚ã€Šå°æ˜Ÿæ˜Ÿã€‹ã€ã€Šç”Ÿæ—¥å¿«ä¹ã€‹
        4. å®«å´éªåŠ¨ç”»éŸ³ä¹ - å¦‚ã€Šåƒä¸åƒå¯»ã€‹ã€ã€Šé¾™çŒ«ã€‹ä¸»é¢˜æ›²
        5. è½»éŸ³ä¹ - å¦‚ã€ŠCity of Starsã€‹ã€ã€ŠRiver Flows in Youã€‹
        
        ä½¿ç”¨æ–¹æ³•ï¼š
        1. å°†éŸ³ä¹æ–‡ä»¶æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹
        2. å–æ¶ˆä¸‹é¢å¯¹åº”è¡Œçš„æ³¨é‡Š
        3. æ›¿æ¢srcä¸ºæ‚¨çš„éŸ³ä¹æ–‡ä»¶è·¯å¾„
        -->
        
        <!-- ç¤ºä¾‹éŸ³ä¹æ–‡ä»¶é“¾æ¥ -->
        <!-- <source src="children-day-music.mp3" type="audio/mpeg"> -->
        <!-- <source src="children-day-music.ogg" type="audio/ogg"> -->
        
        <!-- åœ¨çº¿éŸ³ä¹æœåŠ¡é“¾æ¥ï¼ˆéœ€è¦ç¡®ä¿ç‰ˆæƒåˆè§„ï¼‰ -->
        <!-- <source src="https://example.com/your-music-file.mp3" type="audio/mpeg"> -->
        
        <!-- 
        å¦‚æœæ²¡æœ‰éŸ³ä¹æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨Web Audio APIç”Ÿæˆ
        ç¬¦åˆå„¿ç«¥èŠ‚ä¸»é¢˜çš„è½»æŸ”æ—‹å¾‹ä½œä¸ºèƒŒæ™¯éŸ³ä¹
        -->
    </audio>
    
    <!-- èƒŒæ™¯è£…é¥° -->
    <div class="background-decoration" id="backgroundDecoration"></div>
    
    <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
    <div class="progress-indicator" id="progressIndicator">1/11</div>
    
    <div class="container">
        <!-- ç¬¬1é˜¶æ®µï¼šåŠ è½½ -->
        <div class="stage loading-stage" id="stage1">
            <div class="stage-title">ğŸ æ­£åœ¨ä¸ºåœ†åœ†å°æ±¤åœ†å‡†å¤‡æƒŠå–œ...</div>
            <div class="loading-circle"></div>
            <div class="loading-text">é©¬ä¸Šå°±å¥½å•¦~</div>
        </div>
        
        <!-- ç¬¬2é˜¶æ®µï¼šèº«ä»½éªŒè¯ -->
        <div class="stage" id="stage2">
            <div class="stage-title">ğŸ•µï¸â€â™€ï¸ èº«ä»½å°éªŒè¯</div>
            <div class="stage-instruction">ä¸ºäº†ç¡®ä¿è¿™ä»½æƒŠå–œé€ç»™å¯¹çš„äººï¼Œ<br>è¯·å›ç­”ä¸€ä¸ªå°é—®é¢˜å“¦~</div>
            <div class="quiz-container">
                <div class="quiz-question">ä½ è§‰å¾—è‡ªå·±æœ€åƒå“ªç§å°åŠ¨ç‰©ï¼Ÿ</div>
                <div class="quiz-options">
                    <button class="quiz-option" onclick="nextStage()">ğŸ° è½¯èŒå°å…”å­</button>
                    <button class="quiz-option" onclick="nextStage()">ğŸ± å¯çˆ±å°çŒ«å’ª</button>
                    <button class="quiz-option" onclick="nextStage()">ğŸ¼ åœ†æ»šæ»šç†ŠçŒ«</button>
                    <button class="quiz-option" onclick="nextStage()">ğŸ¦„ æ¢¦å¹»å°ç‹¬è§’å…½</button>
                </div>
            </div>
        </div>
        
        <!-- ç¬¬3é˜¶æ®µï¼šç¤¼ç‰©ç›’ -->
        <div class="stage" id="stage3">
            <div class="stage-title">ğŸˆ åœ†åœ†å°æ±¤åœ†çš„ä¸“å±ç¤¼ç‰©ç›’</div>
            <div class="stage-instruction">éªŒè¯é€šè¿‡ï¼è¿™ä¸ªç¥ç§˜ç¤¼ç‰©ç›’<br>å°±æ˜¯ä¸“é—¨ä¸ºä½ å‡†å¤‡çš„~</div>
            <div class="gift-box" onclick="nextStage()">
                <div class="gift-bow"></div>
            </div>
            <p style="color: white; margin-top: 15px; font-size: 1.1em;">ç‚¹å‡»ç¤¼ç‰©ç›’å¼€å¯æƒŠå–œä¹‹æ—… âœ¨</p>
        </div>
        
        <!-- ç¬¬4é˜¶æ®µï¼šæ˜Ÿç©º -->
        <div class="stage" id="stage4">
            <div class="stage-title">ğŸ’« åœ†åœ†å°æ±¤åœ†çš„çˆ±å¿ƒæ˜Ÿåº§</div>
            <div class="stage-instruction">ä¼ è¯´ä¸­ï¼Œåªæœ‰æœ€çè´µçš„äºº<br>æ‰èƒ½ç‚¹äº®è¿™ä¸ªä¸“å±çˆ±å¿ƒæ˜Ÿåº§~</div>
            <div class="starry-sky" id="starrySky">
                <!-- æ˜Ÿæ˜Ÿå°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                <div class="constellation-hint" id="constellationHint">
                    âœ¨ æŒ‰é¡ºåºç‚¹äº®æ˜Ÿæ˜Ÿï¼Œè§è¯é­”æ³•æ—¶åˆ» âœ¨
                </div>
                <svg class="constellation-lines" id="constellationLines">
                    <!-- è¿æ¥çº¿å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </svg>
            </div>
            <button class="continue-btn" id="stage4Btn" style="display: none;" onclick="nextStage()">
                è¿›å…¥æ—¶å…‰éš§é“ ğŸš€
            </button>
        </div>
        
        <!-- ç¬¬5é˜¶æ®µï¼šæ—¶å…‰éš§é“ -->
        <div class="stage" id="stage5">
            <div class="stage-title">â° æ—¶å…‰éš§é“</div>
            <div class="stage-instruction">è®©æˆ‘ä»¬ä¸€èµ·å›é¡¾é‚£äº›ç¾å¥½çš„ç¬é—´~</div>
            <div class="time-tunnel">
                <div class="memory-card" id="memory1">
                    <div class="memory-text">âœ¨ ç¬¬ä¸€æ¬¡è§åˆ°ä½ æ—¶ï¼Œå°±è§‰å¾—ä½ çœ¼ç›é‡Œæœ‰æ˜Ÿæ˜Ÿ</div>
                </div>
                <div class="memory-card" id="memory2">
                    <div class="memory-text">ğŸŒ¸ ä½ ç¬‘èµ·æ¥çš„æ ·å­ï¼Œæ¯”æ˜¥å¤©çš„æ¨±èŠ±è¿˜è¦ç¾</div>
                </div>
                <div class="memory-card" id="memory3">
                    <div class="memory-text">ğŸˆ ä½ çš„æ¯ä¸€ä¸ªå°è¡¨æƒ…ï¼Œéƒ½è®©æˆ‘è§‰å¾—ä¸–ç•Œæ›´å¯çˆ±äº†</div>
                </div>
            </div>
            <button class="continue-btn" id="stage5Btn" style="display: none;" onclick="nextStage()">
                å¼€å§‹ä¸“å±å°æµ‹è¯• ğŸ“
            </button>
        </div>
        
        <!-- ç¬¬6é˜¶æ®µï¼šä¸“å±å°æµ‹è¯• -->
        <div class="stage" id="stage6">
            <div class="stage-title">ğŸ“ åœ†åœ†å°æ±¤åœ†ä¸“å±æµ‹è¯•</div>
            <div class="stage-instruction">æ¥åšä¸€ä¸ªæœ‰è¶£çš„å°æµ‹è¯•ï¼Œ<br>çœ‹çœ‹æˆ‘æœ‰å¤šäº†è§£ä½ ~</div>
            <div class="test-container">
                <div class="test-progress">
                    <div class="test-progress-bar" id="testProgress"></div>
                </div>
                <div class="quiz-question" id="testQuestion">ä½ æœ€å–œæ¬¢çš„å­£èŠ‚æ˜¯ï¼Ÿ</div>
                <div class="quiz-options">
                    <button class="quiz-option" onclick="answerTest(1)">ğŸŒ¸ æ¸©æŸ”çš„æ˜¥å¤©</button>
                    <button class="quiz-option" onclick="answerTest(2)">â˜€ï¸ æ´»åŠ›çš„å¤å¤©</button>
                    <button class="quiz-option" onclick="answerTest(3)">ğŸ æµªæ¼«çš„ç§‹å¤©</button>
                    <button class="quiz-option" onclick="answerTest(4)">â„ï¸ çº¯å‡€çš„å†¬å¤©</button>
                </div>
            </div>
        </div>
        
        <!-- ç¬¬7é˜¶æ®µï¼šå¹¸è¿ç­¾ -->
        <div class="stage" id="stage7">
            <div class="stage-title">ğŸ­ å„¿ç«¥èŠ‚ç‰¹åˆ«å¹¸è¿ç­¾</div>
            <div class="stage-instruction">æ¥æŠ½å–ä¸“å±äºä½ çš„<br>å„¿ç«¥èŠ‚ç‰¹åˆ«å¹¸è¿å§ï¼</div>
            <div class="candy-jar" onclick="showFortune()">
                <div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); width: 80px; height: 25px; background: #ffd93d; border-radius: 40px;"></div>
            </div>
            <p style="color: white; margin-top: 15px;">ç‚¹å‡»ç³–æœç½æŠ½å–å¹¸è¿ç­¾~</p>
            <div class="fortune-card" id="fortuneCard">
                <div id="fortuneText" style="color: #333; font-weight: 600; margin-bottom: 15px;"></div>
                <div style="color: #ff6b6b; font-style: italic;">â€”â€” æ¥è‡ªä¸€ä¸ªå·å·ä»°æ…•ä½ çš„å¤§æœ‹å‹ ğŸ’•</div>
            </div>
            <button class="continue-btn" id="stage7Btn" style="display: none;" onclick="nextStage()">
                è®¸ä¸‹å¿ƒæ„¿ ğŸ’«
            </button>
        </div>
        
        <!-- ç¬¬8é˜¶æ®µï¼šå¿ƒæ„¿æ”¶é›†ç›’ -->
        <div class="stage" id="stage8">
            <div class="stage-title">ğŸ’« å¿ƒæ„¿æ”¶é›†ç›’</div>
            <div class="stage-instruction">åœ¨è¿™ä¸ªç‰¹åˆ«çš„å„¿ç«¥èŠ‚ï¼Œ<br>æ‚„æ‚„è®¸ä¸‹ä¸€ä¸ªå°å¿ƒæ„¿å§~</div>
            <div class="wish-box">
                <input type="text" class="wish-input" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„å°å¿ƒæ„¿..." id="wishInput">
                <button class="wish-submit" onclick="collectWish()">âœ¨ å°å°åˆ°æ˜Ÿæ²³æ·±å¤„ âœ¨</button>
                <div id="wishResult" style="color: white; margin-top: 20px; display: none;">
                    <p>ğŸŒŸ ä½ çš„å¿ƒæ„¿å·²è¢«é“¶æ²³ç³»æ”¶è—~</p>
                    <p>å®ƒå°†å’Œæœ€äº®çš„æ˜Ÿæ˜Ÿä¸€èµ·ï¼Œå®ˆæŠ¤ç€ä½ çš„æ¢¦æƒ³ï¼</p>
                    <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.8;">ğŸ’« å°ç§˜å¯†ï¼šå¿ƒæ„¿å·²æ‚„æ‚„è®°å½•åœ¨æ—¶å…‰é‡Œ</p>
                </div>
            </div>
            <button class="continue-btn" id="stage8Btn" style="display: none;" onclick="nextStage()">
                è·å¾—ä¸“å±è¯ä¹¦ ğŸ†
            </button>
        </div>
        
        <!-- ç¬¬9é˜¶æ®µï¼šè£èª‰è¯ä¹¦ -->
        <div class="stage" id="stage9">
            <div class="stage-title">ğŸ† ä¸“å±è£èª‰è¯ä¹¦</div>
            <div class="stage-instruction">è¿™æ˜¯ç‰¹åˆ«ä¸ºåœ†åœ†å°æ±¤åœ†<br>å‡†å¤‡çš„å„¿ç«¥èŠ‚è®¤è¯è¯ä¹¦ï¼</div>
            <div class="certificate" id="certificate">
                <div class="certificate-title">ğŸŒŸ å®‡å®™ç¬¬ä¸€ç”œ è®¤è¯è¯ä¹¦ ğŸŒŸ</div>
                <div style="color: #333; line-height: 1.6; font-size: clamp(13px, 3.5vw, 15px);">
                    å…¹æˆäºˆ <strong style="color: #ff6b6b; font-size: 1.2em;">è´ºåœ†åœ†å°æ±¤åœ†</strong> å°æœ‹å‹ï¼Œ<br><br>
                    é‰´äºä½ åœ¨ä¿æŒå¯çˆ±ã€æ•£æ’­å¿«ä¹ã€<br>
                    æ‹¥æœ‰çº¯çœŸç«¥å¿ƒæ–¹é¢è¡¨ç°ä¼˜å¼‚ï¼Œ<br>
                    ç‰¹å‘æ­¤è¯ï¼Œä»¥èµ„é¼“åŠ±ï¼<br><br>
                    æ„¿ä½ æ°¸è¿œæ˜¯é‚£ä¸ªè¢«æ§åœ¨æ‰‹å¿ƒçš„å°å­©ï¼Œ<br>
                    æ„¿ä½ çš„ç«¥å¿ƒæ°¸è¿œé—ªé—ªå‘å…‰ï¼ âœ¨<br><br>
                    <strong>å„¿ç«¥èŠ‚å¿«ä¹ï¼Œåœ†åœ†å°æ±¤åœ†ï¼ ğŸˆ</strong>
                </div>
                <div style="position: absolute; bottom: 15px; right: 15px; width: 60px; height: 60px; background: #ff6b6b; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 800; font-size: 10px; text-align: center; transform: rotate(-15deg);">
                    å®˜æ–¹<br>è®¤è¯<br>å°ç« 
                </div>
            </div>
            <button class="continue-btn" onclick="nextStage()">å¼€å¯ä¸“å±éŸ³ä¹ç›’ ğŸµ</button>
        </div>
        
        <!-- ç¬¬10é˜¶æ®µï¼šéŸ³ä¹ç›’ -->
        <div class="stage" id="stage10">
            <div class="stage-title">ğŸµ åœ†åœ†å°æ±¤åœ†çš„éŸ³ä¹ç›’</div>
            <div class="stage-instruction">è™½ç„¶æ— æ³•æ’­æ”¾çœŸå®çš„éŸ³ä¹ï¼Œ<br>ä½†è®©æˆ‘ç”¨æœ€ç¾çš„æ–¹å¼ä¸ºä½ æ¼”å¥~</div>
            <div class="music-box">
                <!-- éŸ³ä¹å¯è§†åŒ–èƒŒæ™¯ -->
                <div class="music-visualization" id="musicVisualization"></div>
                
                <div class="music-controls">
                    <button class="music-btn" onclick="toggleMusic()" id="musicBtn">â–¶ï¸</button>
                </div>
                
                <div class="music-status" id="musicStatus">
                    ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼Œå¼€å¯è§†è§‰éŸ³ä¹ä¹‹æ—… ğŸ¶
                </div>
                
                <!-- éŸ³ä¹æ­Œè¯å¡ç‰‡ -->
                <div class="music-lyrics" id="musicLyrics">
                    <div class="lyric-line" style="animation-delay: 0s;">ğŸµ è¿™æ˜¯ä¸€é¦–æ²¡æœ‰å£°éŸ³çš„æ­Œ</div>
                    <div class="lyric-line" style="animation-delay: 1s;">ä½†æ¯ä¸€ä¸ªéŸ³ç¬¦éƒ½å†™ç€ä½ çš„åå­—</div>
                    <div class="lyric-line" style="animation-delay: 2s;">ğŸŒ™ æŸ”å’Œçš„æ—‹å¾‹å¦‚æœˆå…‰èˆ¬æ¸©æŸ”</div>
                    <div class="lyric-line" style="animation-delay: 3s;">å°±åƒä½ ç»™æˆ‘çš„æ„Ÿè§‰ä¸€æ ·ç¾å¥½</div>
                    <div class="lyric-line" style="animation-delay: 4s;">ğŸ’• åœ†åœ†å°æ±¤åœ†ï¼Œè¿™æ˜¯å±äºä½ çš„æ­Œ</div>
                </div>
            </div>
            <button class="continue-btn" onclick="nextStage()">æŸ¥çœ‹æœ€ç»ˆæƒŠå–œ ğŸ’Œ</button>
        </div>
        
        <!-- ç¬¬11é˜¶æ®µï¼šæœ€ç»ˆä¿¡ä»¶ -->
        <div class="stage" id="stage11">
            <div class="stage-title">ğŸ’Œ ç»™åœ†åœ†å°æ±¤åœ†çš„ä¿¡</div>
            <div class="final-letter" id="finalLetter">
                <div style="text-align: center; margin-bottom: 20px; font-size: 1.2em; color: #ff6b6b; font-weight: 700;">
                    äº²çˆ±çš„åœ†åœ†å°æ±¤åœ†ï¼š
                </div>
                <div style="text-align: left;">
                    è¿™ä¸ªå„¿ç«¥èŠ‚ï¼Œæˆ‘æƒ³å¯¹ä½ è¯´ï¼š<br><br>
                    
                    ä½ çš„æ¸©æŸ”å¦‚æ˜¥é£ï¼Œè®©äººå¿ƒå®‰ï¼›<br>
                    ä½ çš„èªæ…§å¦‚æ˜æ˜Ÿï¼ŒæŒ‡å¼•æ–¹å‘ï¼›<br>
                    ä½ çš„å¯çˆ±å¦‚ç³–æœï¼Œç”œèœœå¿ƒæˆ¿ï¼›<br>
                    ä½ çš„æ´»æ³¼å¦‚é˜³å…‰ï¼Œæ¸©æš–æ˜äº®ã€‚<br><br>
                    
                    åœ¨è¿™ä¸ªå±äºç«¥å¿ƒçš„èŠ‚æ—¥é‡Œï¼Œæˆ‘å¸Œæœ›ä½ çŸ¥é“ï¼š<br>
                    ä½ å€¼å¾—æ‰€æœ‰çš„ç¾å¥½å’Œå® çˆ±ï¼Œ<br>
                    ä½ çš„å­˜åœ¨è®©è¿™ä¸ªä¸–ç•Œæ›´åŠ å¯çˆ±ï¼Œ<br>
                    æ„¿ä½ æ°¸è¿œä¿æŒé‚£é¢—çè´µçš„ç«¥å¿ƒï¼Œ<br>
                    æ„¿ä½ æ°¸è¿œè¢«æ¸©æŸ”ä»¥å¾…ã€‚<br><br>
                    
                    <!-- å¿ƒæ„¿å±•ç¤ºåŒºåŸŸ -->
                    <div id="wishDisplay" style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #ff6b6b;">
                        <strong style="color: #ff6b6b;">ğŸ’« ä½ è®¸ä¸‹çš„å°å¿ƒæ„¿ï¼š</strong><br>
                        <span id="wishContent" style="font-style: italic; color: #fff; font-size: 0.95em;">"æš‚æ—¶è¿˜æ²¡æœ‰è®¸æ„¿å“¦~"</span>
                    </div>
                    
                    æœ€åï¼Œæƒ³è¦å‘Šè¯‰ä½ ï¼š<br>
                    <strong style="color: #ff6b6b;">åœ¨è¿™ä¸ªç‰¹åˆ«çš„æ—¥å­é‡Œï¼Œæ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾… ğŸŒŸ</strong><br><br>
                    
                    å„¿ç«¥èŠ‚å¿«ä¹ï¼Œæˆ‘çš„å°æ±¤åœ†ï¼<br>
                    æ„¿ä½ æ¯å¤©éƒ½åƒä»Šå¤©ä¸€æ ·å¼€å¿ƒ~ ğŸˆ
                </div>
                <div style="text-align: right; margin-top: 20px; color: #ff6b6b; font-style: italic;">
                    â€”â€” ä¸€ä¸ªæƒ³è®©ä½ å¼€å¿ƒçš„æœ‹å‹ ğŸŒ¸
                </div>
            </div>
            <div style="color: white; margin-top: 30px; text-align: center; font-size: 1.1em;">
                ğŸ‰ æƒŠå–œæ—…ç¨‹åœ†æ»¡ç»“æŸ ğŸ‰<br>
                <small style="opacity: 0.8;">å¸Œæœ›è¿™ä»½å°å°çš„å¿ƒæ„èƒ½è®©ä½ å¼€å¿ƒ~</small>
            </div>
        </div>
    </div>

    <script>
        let currentStage = 1;
        let starsLit = 0;
        let totalStars = 6;
        let testQuestionIndex = 0;
        let isPlaying = false;
        let collectedWish = "";
        
        // èƒŒæ™¯éŸ³ä¹å˜é‡
        let backgroundMusicPlaying = false;
        let backgroundAudioContext;
        let backgroundOscillators = [];
        let currentVolume = 0.7;
        
        // å„¿ç«¥èŠ‚ä¸»é¢˜æ—‹å¾‹ï¼ˆCå¤§è°ƒï¼Œæ¸©é¦¨æ„‰å¿«ï¼‰
        const melodyNotes = [
            { freq: 261.63, duration: 0.5 }, // C
            { freq: 293.66, duration: 0.5 }, // D
            { freq: 329.63, duration: 0.5 }, // E
            { freq: 349.23, duration: 0.5 }, // F
            { freq: 392.00, duration: 0.8 }, // G
            { freq: 329.63, duration: 0.3 }, // E
            { freq: 293.66, duration: 0.3 }, // D
            { freq: 261.63, duration: 1.0 }, // C
            
            { freq: 392.00, duration: 0.5 }, // G
            { freq: 349.23, duration: 0.5 }, // F
            { freq: 329.63, duration: 0.5 }, // E
            { freq: 293.66, duration: 0.5 }, // D
            { freq: 261.63, duration: 1.5 }, // C
        ];
        
        const starMessages = [
            "ä½ æ˜¯æˆ‘è§è¿‡æœ€æ¸©æŸ”çš„æ˜Ÿå…‰ï¼Œç…§äº®äº†æ•´ä¸ªé“¶æ²³ ğŸŒ™âœ¨",
            "å¦‚æœå¯çˆ±æœ‰é‡é‡ï¼Œä½ ä¸€å®šå‹å¡Œäº†æ•´ä¸ªå®‡å®™ ğŸ’«ğŸŒŸ",
            "ä½ çš„ç¬‘å®¹æ¯”æ˜¥å¤©çš„æ¨±èŠ±è¿˜è¦ç¾ï¼Œæ¯”å¤å¤©çš„é˜³å…‰è¿˜è¦æš– ğŸŒ¸â˜€ï¸",
            "æ¯ä¸€æ¬¡çœ‹åˆ°ä½ ï¼Œéƒ½æ„Ÿè§‰è¿™ä¸ªä¸–ç•Œåœ¨å¯¹æˆ‘çœ¨çœ¼ç› ğŸ˜ŠğŸ’•",
            "ä½ å°±åƒæ˜¯æ‰è¿›æˆ‘ç”Ÿå‘½é‡Œçš„å°æ˜Ÿæ˜Ÿï¼Œé—ªé—ªå‘å…‰ä¸”çè´µæ— æ¯” â­ğŸ’",
            "é‡è§ä½ çš„é‚£ä¸€åˆ»ï¼Œæˆ‘å°±çŸ¥é“ï¼Œè¿™å°±æ˜¯æˆ‘è¦å®ˆæŠ¤çš„å…¨ä¸–ç•Œ ğŸŒâ¤ï¸"
        ];
        
        const fortunes = [
            "ğŸ€ å¹¸è¿ç­¾ï¼šä»Šå¤©å®œè¢«å® çˆ±ï¼Œå®œæ”¶è·æ‰€æœ‰ç¾å¥½ï¼Œå®œå½“ä¸ªå¿«ä¹çš„å°å­©ï¼",
            "ğŸ­ ç³–æœçº¸ï¼šè¿™é¢—ç³–ä»£è¡¨æˆ‘çš„å¿ƒï¼Œå¸Œæœ›åœ†åœ†å°æ±¤åœ†èƒ½æ„Ÿå—åˆ°å®ƒçš„ç”œï¼",
            "ğŸŒŸ é­”æ³•é¢„è¨€ï¼šä½ å°†ä¼šè¢«ä¸€ä¸ªå¾ˆæ¬£èµä½ çš„äººï¼Œç”¨å¿ƒå®ˆæŠ¤è¿™ä»½çè´µçš„ç«¥çœŸï¼",
            "ğŸˆ å„¿ç«¥èŠ‚ç‰¹åˆ«æ¬¾ï¼šæ„¿ä½ æ°¸è¿œæ‹¥æœ‰çœ‹è§ç¾å¥½çš„çœ¼ç›å’Œæ„Ÿå—å¹¸ç¦çš„å¿ƒï¼",
            "ğŸ’« ä¸“å±å¹¸è¿ï¼šä»Šæ—¥ä»½çš„å¼€å¿ƒåŠ å€ï¼Œè¢«çˆ±æŒ‡æ•°çˆ†è¡¨ï¼Œç«¥å¿ƒæ»¡å€¼ï¼"
        ];
        
        const testQuestions = [
            {
                question: "ä½ æœ€å–œæ¬¢çš„å­£èŠ‚æ˜¯ï¼Ÿ",
                options: ["ğŸŒ¸ æ¸©æŸ”çš„æ˜¥å¤©", "â˜€ï¸ æ´»åŠ›çš„å¤å¤©", "ğŸ æµªæ¼«çš„ç§‹å¤©", "â„ï¸ çº¯å‡€çš„å†¬å¤©"]
            },
            {
                question: "ä½ è§‰å¾—æœ€æµªæ¼«çš„äº‹æƒ…æ˜¯ï¼Ÿ",
                options: ["ğŸŒ™ ä¸€èµ·çœ‹æ˜Ÿæ˜Ÿ", "ğŸŒ¸ åœ¨æ¨±èŠ±ä¸‹æ¼«æ­¥", "â˜• å®‰é™çš„ä¸‹åˆèŒ¶", "ğŸµ å¬å–œæ¬¢çš„éŸ³ä¹"]
            },
            {
                question: "ä½ æœ€æƒ³å»çš„åœ°æ–¹æ˜¯ï¼Ÿ",
                options: ["ğŸ”ï¸ å®‰é™çš„å±±é¡¶", "ğŸ–ï¸ æ¸©æš–çš„æµ·è¾¹", "ğŸŒ¸ æµªæ¼«çš„èŠ±å›­", "ğŸ° ç«¥è¯èˆ¬çš„åŸå ¡"]
            }
        ];
        
        // çˆ±å¿ƒå½¢çŠ¶çš„æ˜Ÿæ˜Ÿåæ ‡ï¼ˆç™¾åˆ†æ¯”ä½ç½®ï¼‰
        const heartStarPositions = [
            { x: 50, y: 30, number: 1 },  // é¡¶éƒ¨ä¸­å¿ƒ
            { x: 35, y: 20, number: 2 },  // å·¦ä¸Š
            { x: 65, y: 20, number: 3 },  // å³ä¸Š  
            { x: 25, y: 45, number: 4 },  // å·¦ä¸­
            { x: 75, y: 45, number: 5 },  // å³ä¸­
            { x: 50, y: 70, number: 6 }   // åº•éƒ¨å°–ç«¯
        ];
        
        // çˆ±å¿ƒè¿çº¿è·¯å¾„ï¼ˆè¿æ¥é¡ºåºï¼‰
        const heartConnections = [
            [0, 1], // é¡¶éƒ¨åˆ°å·¦ä¸Š
            [0, 2], // é¡¶éƒ¨åˆ°å³ä¸Š
            [1, 3], // å·¦ä¸Šåˆ°å·¦ä¸­
            [2, 4], // å³ä¸Šåˆ°å³ä¸­
            [3, 5], // å·¦ä¸­åˆ°åº•éƒ¨
            [4, 5]  // å³ä¸­åˆ°åº•éƒ¨
        ];
        
        let currentStarIndex = 0;
        
        // åˆ›å»ºèƒŒæ™¯è£…é¥°
        function createBackgroundDecorations() {
            const container = document.getElementById('backgroundDecoration');
            const decorations = ['ğŸ’•', 'âœ¨', 'ğŸŒŸ', 'ğŸˆ', 'ğŸŒ¸', 'ğŸ’«'];
            
            for (let i = 0; i < 15; i++) {
                const element = document.createElement('div');
                element.className = 'floating-element';
                element.innerHTML = decorations[Math.floor(Math.random() * decorations.length)];
                element.style.left = Math.random() * 100 + '%';
                element.style.top = Math.random() * 100 + '%';
                element.style.animationDelay = Math.random() * 6 + 's';
                element.style.color = `rgba(255, 255, 255, ${0.4 + Math.random() * 0.4})`;
                container.appendChild(element);
            }
        }
        
        // æ›´æ–°è¿›åº¦æŒ‡ç¤ºå™¨
        function updateProgress() {
            document.getElementById('progressIndicator').textContent = `${currentStage}/11`;
        }
        
        // åˆ‡æ¢åˆ°ä¸‹ä¸€é˜¶æ®µ
        function nextStage() {
            document.getElementById(`stage${currentStage}`).classList.remove('active');
            currentStage++;
            if (currentStage <= 11) {
                document.getElementById(`stage${currentStage}`).classList.add('active');
                updateProgress();
                
                // ç‰¹æ®Šé˜¶æ®µå¤„ç†
                if (currentStage === 4) {
                    setTimeout(createStarryNight, 500);
                } else if (currentStage === 5) {
                    setTimeout(showMemories, 500);
                } else if (currentStage === 9) {
                    setTimeout(() => {
                        document.getElementById('certificate').classList.add('show');
                    }, 500);
                } else if (currentStage === 11) {
                    setTimeout(() => {
                        document.getElementById('finalLetter').classList.add('show');
                        // å¦‚æœæœ‰æ”¶é›†åˆ°å¿ƒæ„¿ï¼Œæ˜¾ç¤ºåœ¨æœ€ç»ˆä¿¡ä»¶ä¸­
                        if (collectedWish) {
                            document.getElementById('wishContent').textContent = `"${collectedWish}"`;
                            document.getElementById('wishContent').style.color = '#ffd93d';
                        }
                    }, 500);
                }
            }
        }
        
        // åˆ›å»ºæ˜Ÿç©º
        function createStarryNight() {
            const sky = document.getElementById('starrySky');
            const svg = document.getElementById('constellationLines');
            
            // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
            const existingStars = sky.querySelectorAll('.star');
            existingStars.forEach(star => star.remove());
            
            // åˆ›å»ºçˆ±å¿ƒå½¢çŠ¶çš„æ˜Ÿæ˜Ÿ
            heartStarPositions.forEach((pos, index) => {
                const star = document.createElement('div');
                star.className = 'star';
                star.innerHTML = 'â­';
                star.dataset.index = index;
                star.dataset.number = pos.number;
                
                star.style.left = pos.x + '%';
                star.style.top = pos.y + '%';
                
                // ç¬¬ä¸€é¢—æ˜Ÿæ˜Ÿå¼€å§‹æ—¶å°±å¯ä»¥ç‚¹å‡»
                if (index === 0) {
                    star.classList.add('next');
                }
                
                star.addEventListener('click', function() {
                    lightUpStar(this, index);
                });
                
                sky.appendChild(star);
            });
            
            // åˆ›å»ºè¿æ¥çº¿çš„SVGè·¯å¾„
            createConstellationLines(svg);
            
            // éšè—æç¤ºï¼Œæ˜¾ç¤ºæ–°çš„æŒ‡å¯¼
            setTimeout(() => {
                const hint = document.getElementById('constellationHint');
                hint.innerHTML = 'ğŸ’« ç‚¹å‡»ç¬¬1é¢—æ˜Ÿæ˜Ÿå¼€å§‹é­”æ³• ğŸ’«';
                hint.style.animation = 'hintPulse 1s ease-in-out infinite';
            }, 500);
        }
        
        // åˆ›å»ºæ˜Ÿåº§è¿çº¿
        function createConstellationLines(svg) {
            heartConnections.forEach((connection, index) => {
                const [startIndex, endIndex] = connection;
                const startPos = heartStarPositions[startIndex];
                const endPos = heartStarPositions[endIndex];
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.classList.add('constellation-line');
                line.setAttribute('x1', startPos.x + '%');
                line.setAttribute('y1', startPos.y + '%');
                line.setAttribute('x2', endPos.x + '%');
                line.setAttribute('y2', endPos.y + '%');
                line.setAttribute('data-connection', index);
                
                svg.appendChild(line);
            });
        }
        
        // ç‚¹äº®æ˜Ÿæ˜Ÿï¼ˆé‡å†™ç‰ˆæœ¬ï¼‰
        function lightUpStar(starElement, index) {
            // æ£€æŸ¥æ˜¯å¦æ˜¯æ­£ç¡®çš„é¡ºåº
            if (index !== currentStarIndex) {
                // å¦‚æœç‚¹å‡»é¡ºåºé”™è¯¯ï¼Œç»™å‡ºæç¤º
                createMagicSparkle(starElement, 'âŒ');
                showOrderHint();
                return;
            }
            
            if (starElement.classList.contains('lit')) return;
            
            // ç§»é™¤"ä¸‹ä¸€ä¸ª"çŠ¶æ€
            starElement.classList.remove('next');
            
            // ç‚¹äº®æ˜Ÿæ˜Ÿ
            starElement.classList.add('lit');
            currentStarIndex++;
            
            // æ·»åŠ é­”æ³•é—ªçƒæ•ˆæœ
            createMagicSparkle(starElement, 'âœ¨');
            
            // æ˜¾ç¤ºæ˜Ÿæ˜Ÿæ¶ˆæ¯
            showStarMessage(starElement, starMessages[index]);
            
            // æ¿€æ´»ç›¸å…³çš„è¿æ¥çº¿
            activateConnections(index);
            
            // è®¾ç½®ä¸‹ä¸€é¢—æ˜Ÿæ˜Ÿä¸ºå¯ç‚¹å‡»çŠ¶æ€
            if (currentStarIndex < heartStarPositions.length) {
                const nextStar = document.querySelector(`[data-index="${currentStarIndex}"]`);
                if (nextStar) {
                    nextStar.classList.add('next');
                }
                
                // æ›´æ–°æç¤º
                const hint = document.getElementById('constellationHint');
                hint.innerHTML = `ğŸ’« ç‚¹å‡»ç¬¬${currentStarIndex + 1}é¢—æ˜Ÿæ˜Ÿç»§ç»­é­”æ³• ğŸ’«`;
            } else {
                // æ‰€æœ‰æ˜Ÿæ˜Ÿéƒ½ç‚¹äº®äº†ï¼Œå®Œæˆçˆ±å¿ƒæ˜Ÿåº§
                completeHeartConstellation();
            }
        }
        
        // æ¿€æ´»è¿æ¥çº¿
        function activateConnections(starIndex) {
            heartConnections.forEach((connection, connectionIndex) => {
                const [startIndex, endIndex] = connection;
                
                // å¦‚æœè¿™æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹éƒ½å·²ç»ç‚¹äº®ï¼Œå°±æ¿€æ´»è¿™æ¡çº¿
                if ((startIndex <= currentStarIndex - 1) && (endIndex <= currentStarIndex - 1)) {
                    const line = document.querySelector(`[data-connection="${connectionIndex}"]`);
                    if (line && !line.classList.contains('active')) {
                        setTimeout(() => {
                            line.classList.add('active');
                        }, 300);
                    }
                }
            });
        }
        
        // å®Œæˆçˆ±å¿ƒæ˜Ÿåº§
        function completeHeartConstellation() {
            const sky = document.getElementById('starrySky');
            const hint = document.getElementById('constellationHint');
            
            // æ›´æ–°æç¤º
            hint.innerHTML = 'ğŸ’– çˆ±å¿ƒæ˜Ÿåº§å®Œæˆï¼ä½ æ˜¯æœ€ç‰¹åˆ«çš„é‚£ä¸ªäºº ğŸ’–';
            hint.style.animation = 'hintPulse 0.8s ease-in-out infinite';
            
            // æ·»åŠ å®Œæˆæ•ˆæœ
            sky.classList.add('heart-complete');
            
            // åˆ›å»ºåº†ç¥æ•ˆæœ
            setTimeout(() => {
                createCelebrationEffect();
            }, 500);
            
            // æ˜¾ç¤ºç»§ç»­æŒ‰é’®
            setTimeout(() => {
                document.getElementById('stage4Btn').style.display = 'inline-block';
            }, 2500);
        }
        
        // åˆ›å»ºé­”æ³•é—ªçƒæ•ˆæœ
        function createMagicSparkle(starElement, symbol) {
            const sparkle = document.createElement('div');
            sparkle.className = 'magic-sparkle';
            sparkle.innerHTML = symbol;
            
            const rect = starElement.getBoundingClientRect();
            const skyRect = document.getElementById('starrySky').getBoundingClientRect();
            
            sparkle.style.left = (rect.left - skyRect.left + rect.width / 2) + 'px';
            sparkle.style.top = (rect.top - skyRect.top + rect.height / 2) + 'px';
            
            document.getElementById('starrySky').appendChild(sparkle);
            
            setTimeout(() => {
                if (sparkle.parentNode) {
                    sparkle.parentNode.removeChild(sparkle);
                }
            }, 2000);
        }
        
        // æ˜¾ç¤ºé¡ºåºæç¤º
        function showOrderHint() {
            const hint = document.getElementById('constellationHint');
            const originalText = hint.innerHTML;
            
            hint.innerHTML = 'ğŸŒŸ è¯·æŒ‰æ•°å­—é¡ºåºç‚¹å‡»æ˜Ÿæ˜Ÿå“¦~ ğŸŒŸ';
            hint.style.color = '#ff6b6b';
            
            setTimeout(() => {
                hint.innerHTML = originalText;
                hint.style.color = '';
            }, 2000);
        }
        
        // åˆ›å»ºåº†ç¥æ•ˆæœ
        function createCelebrationEffect() {
            const sky = document.getElementById('starrySky');
            const celebrationSymbols = ['ğŸ’•', 'ğŸ’–', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'ğŸ’'];
            
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const celebration = document.createElement('div');
                    celebration.className = 'magic-sparkle';
                    celebration.innerHTML = celebrationSymbols[Math.floor(Math.random() * celebrationSymbols.length)];
                    
                    celebration.style.left = Math.random() * 80 + 10 + '%';
                    celebration.style.top = Math.random() * 60 + 20 + '%';
                    celebration.style.animationDelay = '0s';
                    celebration.style.animationDuration = '3s';
                    
                    sky.appendChild(celebration);
                    
                    setTimeout(() => {
                        if (celebration.parentNode) {
                            celebration.parentNode.removeChild(celebration);
                        }
                    }, 3000);
                }, i * 200);
            }
        }
        
        // æ˜¾ç¤ºæ˜Ÿæ˜Ÿæ¶ˆæ¯
        function showStarMessage(starElement, message) {
            const existingMessage = document.querySelector('.star-message.show');
            if (existingMessage) {
                existingMessage.classList.remove('show');
                setTimeout(() => existingMessage.remove(), 500);
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'star-message';
            messageDiv.textContent = message;
            
            const starRect = starElement.getBoundingClientRect();
            const skyRect = document.getElementById('starrySky').getBoundingClientRect();
            
            messageDiv.style.left = Math.max(10, Math.min(skyRect.width - 200, starRect.left - skyRect.left - 80)) + 'px';
            messageDiv.style.top = (starRect.top - skyRect.top - 60) + 'px';
            
            document.getElementById('starrySky').appendChild(messageDiv);
            
            setTimeout(() => messageDiv.classList.add('show'), 100);
            
            setTimeout(() => {
                messageDiv.classList.remove('show');
                setTimeout(() => messageDiv.remove(), 500);
            }, 3000);
        }
        
        // æ˜¾ç¤ºå›å¿†
        function showMemories() {
            const memories = ['memory1', 'memory2', 'memory3'];
            memories.forEach((id, index) => {
                setTimeout(() => {
                    document.getElementById(id).classList.add('show');
                    if (index === memories.length - 1) {
                        setTimeout(() => {
                            document.getElementById('stage5Btn').style.display = 'inline-block';
                        }, 1000);
                    }
                }, index * 800);
            });
        }
        
        // å›ç­”æµ‹è¯•
        function answerTest(answer) {
            testQuestionIndex++;
            const progress = (testQuestionIndex / testQuestions.length) * 100;
            document.getElementById('testProgress').style.width = progress + '%';
            
            if (testQuestionIndex < testQuestions.length) {
                setTimeout(() => {
                    const currentTest = testQuestions[testQuestionIndex];
                    document.getElementById('testQuestion').textContent = currentTest.question;
                    
                    // æ›´æ–°é€‰é¡¹
                    const optionButtons = document.querySelectorAll('#stage6 .quiz-option');
                    optionButtons.forEach((button, index) => {
                        if (currentTest.options[index]) {
                            button.textContent = currentTest.options[index];
                            button.style.display = 'block';
                        } else {
                            button.style.display = 'none';
                        }
                    });
                }, 500);
            } else {
                setTimeout(() => {
                    document.getElementById('testQuestion').textContent = "æµ‹è¯•å®Œæˆï¼ä½ çœŸçš„å¾ˆæ£’~ ğŸ’•";
                    document.querySelector('#stage6 .quiz-options').style.display = 'none';
                    setTimeout(nextStage, 2000);
                }, 500);
            }
        }
        
        // æ˜¾ç¤ºå¹¸è¿ç­¾
        function showFortune() {
            const randomFortune = fortunes[Math.floor(Math.random() * fortunes.length)];
            document.getElementById('fortuneText').textContent = randomFortune;
            
            setTimeout(() => {
                document.getElementById('fortuneCard').classList.add('show');
                setTimeout(() => {
                    document.getElementById('stage7Btn').style.display = 'inline-block';
                }, 1000);
            }, 500);
        }
        
        // æ”¶é›†å¿ƒæ„¿
        function collectWish() {
            const wish = document.getElementById('wishInput').value;
            if (wish.trim()) {
                collectedWish = wish;
                
                // åœ¨æ§åˆ¶å°è¾“å‡ºå¿ƒæ„¿å†…å®¹ï¼ˆä¾›æ‚¨æŸ¥çœ‹ï¼‰
                console.log('=== åœ†åœ†å°æ±¤åœ†çš„å¿ƒæ„¿ ===');
                console.log('å¿ƒæ„¿å†…å®¹:', wish);
                console.log('æ—¶é—´:', new Date().toLocaleString());
                console.log('========================');
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
                try {
                    localStorage.setItem('yuanyuan_wish', JSON.stringify({
                        wish: wish,
                        timestamp: new Date().toISOString()
                    }));
                } catch (e) {
                    console.log('æœ¬åœ°å­˜å‚¨ä¿å­˜å¤±è´¥ï¼Œä½†å¿ƒæ„¿å·²æ”¶é›†');
                }
                
                // æ·»åŠ å¿ƒæ„¿å°å°çš„é­”æ³•æ•ˆæœ
                createWishSealEffect();
                
                document.getElementById('wishResult').style.display = 'block';
                document.getElementById('wishInput').style.display = 'none';
                document.querySelector('.wish-submit').style.display = 'none';
                setTimeout(() => {
                    document.getElementById('stage8Btn').style.display = 'inline-block';
                }, 3000);
            } else {
                // æ›´æ¸©æŸ”çš„æç¤º
                showTip('è¯·å…ˆè®¸ä¸‹ä½ çš„å°å¿ƒæ„¿å“¦~ ğŸ’«', 2000);
            }
        }
        
        // åˆ›å»ºå¿ƒæ„¿å°å°é­”æ³•æ•ˆæœ
        function createWishSealEffect() {
            const wishBox = document.querySelector('.wish-box');
            const magicalSymbols = ['âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'â­', 'ğŸ”®', 'ğŸ’'];
            
            // åˆ›å»ºç¯ç»•çš„é­”æ³•ç²’å­
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.style.cssText = `
                        position: absolute;
                        font-size: 20px;
                        color: #ffd93d;
                        pointer-events: none;
                        z-index: 100;
                        animation: sealMagic 2s ease-out forwards;
                    `;
                    particle.textContent = magicalSymbols[Math.floor(Math.random() * magicalSymbols.length)];
                    
                    // éšæœºä½ç½®å›´ç»•å¿ƒæ„¿ç›’
                    const angle = (i / 8) * 360;
                    const radius = 80;
                    const x = Math.cos(angle * Math.PI / 180) * radius;
                    const y = Math.sin(angle * Math.PI / 180) * radius;
                    
                    particle.style.left = `calc(50% + ${x}px)`;
                    particle.style.top = `calc(50% + ${y}px)`;
                    particle.style.transform = 'translate(-50%, -50%)';
                    
                    wishBox.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 2000);
                }, i * 100);
            }
        }
        
        // éŸ³ä¹æ§åˆ¶
        function toggleMusic() {
            const btn = document.getElementById('musicBtn');
            const status = document.getElementById('musicStatus');
            
            if (isPlaying) {
                btn.innerHTML = 'â–¶ï¸';
                status.textContent = 'éŸ³ä¹å·²æš‚åœ â¸ï¸';
                stopMusic();
                isPlaying = false;
            } else {
                btn.innerHTML = 'â¸ï¸';
                status.textContent = 'æ­£åœ¨ä¸ºåœ†åœ†å°æ±¤åœ†æ¼”å¥ä¸“å±éŸ³ä¹... ğŸµ';
                playMusic();
                isPlaying = true;
            }
        }
        
        function playMusic() {
            // æ˜¾ç¤ºéŸ³ä¹å¯è§†åŒ–
            const visualization = document.querySelector('.music-visualization');
            const lyrics = document.querySelector('.music-lyrics');
            const status = document.querySelector('.music-status');
            
            visualization.classList.add('playing');
            status.classList.add('show');
            
            // åˆ›å»ºé£˜åŠ¨çš„éŸ³ç¬¦
            createFloatingNotes();
            
            // å»¶è¿Ÿæ˜¾ç¤ºæ­Œè¯
            setTimeout(() => {
                lyrics.classList.add('show');
            }, 1000);
        }
        
        function stopMusic() {
            // éšè—éŸ³ä¹å¯è§†åŒ–
            const visualization = document.querySelector('.music-visualization');
            const lyrics = document.querySelector('.music-lyrics');
            
            visualization.classList.remove('playing');
            lyrics.classList.remove('show');
            
            // æ¸…é™¤éŸ³ç¬¦
            visualization.innerHTML = '';
        }
        
        function createFloatingNotes() {
            const visualization = document.getElementById('musicVisualization');
            const notes = ['ğŸµ', 'ğŸ¶', 'â™ª', 'â™«', 'ğŸ¼', 'ğŸ¤'];
            
            function addNote() {
                if (!isPlaying) return;
                
                const note = document.createElement('div');
                note.className = 'music-note';
                note.textContent = notes[Math.floor(Math.random() * notes.length)];
                
                // éšæœºä½ç½®
                note.style.left = Math.random() * 80 + 10 + '%';
                note.style.animationDelay = Math.random() * 1 + 's';
                note.style.animationDuration = (2 + Math.random() * 2) + 's';
                
                visualization.appendChild(note);
                
                // 3ç§’åç§»é™¤éŸ³ç¬¦
                setTimeout(() => {
                    if (note.parentNode) {
                        note.parentNode.removeChild(note);
                    }
                }, 3000);
                
                // ç»§ç»­æ·»åŠ éŸ³ç¬¦
                if (isPlaying) {
                    setTimeout(addNote, 500 + Math.random() * 1000);
                }
            }
            
            // å¼€å§‹æ·»åŠ éŸ³ç¬¦
            addNote();
            setTimeout(addNote, 300);
            setTimeout(addNote, 600);
        }
        
        // èƒŒæ™¯éŸ³ä¹æ§åˆ¶
        function toggleBackgroundMusic() {
            const button = document.getElementById('bgMusicToggle');
            const waves = document.getElementById('audioWaves');
            const audio = document.getElementById('backgroundMusic');
            
            if (backgroundMusicPlaying) {
                // åœæ­¢éŸ³ä¹
                if (audio.src) {
                    audio.pause();
                } else {
                    stopBackgroundMusic();
                }
                button.innerHTML = 'ğŸµ';
                waves.classList.add('paused');
                backgroundMusicPlaying = false;
            } else {
                // å¼€å§‹æ’­æ”¾éŸ³ä¹
                if (audio.src) {
                    // å¦‚æœæœ‰éŸ³é¢‘æ–‡ä»¶ï¼Œä½¿ç”¨HTML5 audio
                    audio.volume = currentVolume;
                    audio.play().catch(() => {
                        // å¦‚æœHTML5éŸ³é¢‘å¤±è´¥ï¼Œä½¿ç”¨Web Audio API
                        startBackgroundMusic();
                    });
                } else {
                    // ä½¿ç”¨Web Audio APIç”ŸæˆéŸ³ä¹
                    startBackgroundMusic();
                }
                button.innerHTML = 'â¸ï¸';
                waves.classList.remove('paused');
                backgroundMusicPlaying = true;
            }
        }
        
        // ä½¿ç”¨Web Audio APIç”ŸæˆèƒŒæ™¯éŸ³ä¹ï¼ˆå¢å¼ºç§»åŠ¨ç«¯æ”¯æŒï¼‰
        function startBackgroundMusic() {
            try {
                // ç§»åŠ¨ç«¯éœ€è¦åœ¨ç”¨æˆ·äº¤äº’åæ‰èƒ½åˆ›å»ºAudioContext
                if (!backgroundAudioContext) {
                    backgroundAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // æ£€æŸ¥AudioContextçŠ¶æ€ï¼Œç§»åŠ¨ç«¯å¯èƒ½éœ€è¦resume
                if (backgroundAudioContext.state === 'suspended') {
                    backgroundAudioContext.resume().then(() => {
                        playMelodyLoop();
                    }).catch(() => {
                        showMusicTip();
                    });
                } else {
                    playMelodyLoop();
                }
                
            } catch (error) {
                console.log('Web Audio APIä¸å¯ç”¨:', error);
                showMusicTip();
            }
        }
        
        function playMelodyLoop() {
            if (!backgroundMusicPlaying || !backgroundAudioContext) return;
            
            let currentTime = backgroundAudioContext.currentTime;
            let noteIndex = 0;
            
            function scheduleNote() {
                if (!backgroundMusicPlaying || noteIndex >= melodyNotes.length) {
                    if (backgroundMusicPlaying) {
                        // å¾ªç¯æ’­æ”¾
                        setTimeout(() => playMelodyLoop(), 2000);
                    }
                    return;
                }
                
                try {
                    const note = melodyNotes[noteIndex];
                    const oscillator = backgroundAudioContext.createOscillator();
                    const gainNode = backgroundAudioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(backgroundAudioContext.destination);
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(note.freq, currentTime);
                    
                    // æ¸©æŸ”çš„éŸ³é‡åŒ…ç»œï¼ˆé™ä½éŸ³é‡ä»¥é€‚åº”ç§»åŠ¨ç«¯ï¼‰
                    gainNode.gain.setValueAtTime(0, currentTime);
                    gainNode.gain.linearRampToValueAtTime(currentVolume * 0.05, currentTime + 0.05);
                    gainNode.gain.linearRampToValueAtTime(currentVolume * 0.04, currentTime + note.duration - 0.05);
                    gainNode.gain.linearRampToValueAtTime(0, currentTime + note.duration);
                    
                    oscillator.start(currentTime);
                    oscillator.stop(currentTime + note.duration);
                    
                    backgroundOscillators.push(oscillator);
                    
                    currentTime += note.duration;
                    noteIndex++;
                    
                    setTimeout(scheduleNote, note.duration * 500);
                } catch (error) {
                    console.log('æ’­æ”¾éŸ³ç¬¦æ—¶å‡ºé”™:', error);
                }
            }
            
            scheduleNote();
        }
        
        function stopBackgroundMusic() {
            backgroundOscillators.forEach(osc => {
                try {
                    osc.stop();
                } catch (e) {
                    // å¿½ç•¥å·²ç»åœæ­¢çš„æŒ¯è¡å™¨
                }
            });
            backgroundOscillators = [];
        }
        
        // éŸ³é‡æ§åˆ¶
        function adjustVolume(event) {
            const volumeControl = document.getElementById('volumeControl');
            const volumeBar = document.getElementById('volumeBar');
            const audio = document.getElementById('backgroundMusic');
            
            const rect = volumeControl.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percentage = Math.max(0, Math.min(1, x / rect.width));
            
            currentVolume = percentage;
            volumeBar.style.width = (percentage * 100) + '%';
            
            if (audio.src) {
                audio.volume = currentVolume;
            }
        }
        
        // è§¦æ‘¸äº‹ä»¶éŸ³é‡è°ƒèŠ‚ï¼ˆç§»åŠ¨ç«¯æ”¯æŒï¼‰
        function adjustVolumeTouch(event) {
            event.preventDefault(); // é˜²æ­¢é»˜è®¤è§¦æ‘¸è¡Œä¸º
            
            const volumeControl = document.getElementById('volumeControl');
            const volumeBar = document.getElementById('volumeBar');
            const audio = document.getElementById('backgroundMusic');
            
            const touch = event.touches[0];
            const rect = volumeControl.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const percentage = Math.max(0, Math.min(1, x / rect.width));
            
            currentVolume = percentage;
            volumeBar.style.width = (percentage * 100) + '%';
            
            if (audio.src) {
                audio.volume = currentVolume;
            }
        }
        
        // æ˜¾ç¤ºéŸ³ä¹æç¤ºï¼ˆä¼˜åŒ–ç§»åŠ¨ç«¯æç¤ºï¼‰
        function showMusicTip() {
            const tip = document.createElement('div');
            tip.style.cssText = `
                position: fixed;
                top: 80px;
                left: 20px;
                background: rgba(255,255,255,0.95);
                padding: 15px;
                border-radius: 10px;
                color: #333;
                font-size: 14px;
                max-width: 280px;
                z-index: 1002;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                line-height: 1.5;
            `;
            tip.innerHTML = `
                <strong>ğŸµ èƒŒæ™¯éŸ³ä¹æç¤º</strong><br>
                æ‚¨çš„è®¾å¤‡å¯èƒ½ä¸æ”¯æŒéŸ³é¢‘è‡ªåŠ¨æ’­æ”¾ã€‚<br>
                è¯·ç‚¹å‡»éŸ³ä¹æ§åˆ¶å™¨çš„æ’­æ”¾æŒ‰é’®æ¥å¯åŠ¨èƒŒæ™¯éŸ³ä¹~<br>
                <small style="opacity: 0.7; margin-top: 8px; display: block;">
                ğŸ’¡ æœ‰äº›æ‰‹æœºéœ€è¦è°ƒæ•´éŸ³é‡æˆ–æ£€æŸ¥é™éŸ³æ¨¡å¼
                </small>
            `;
            document.body.appendChild(tip);
            
            setTimeout(() => {
                if (tip.parentNode) {
                    tip.parentNode.removeChild(tip);
                }
            }, 6000);
        }
        
        // è‡ªåŠ¨å¼€å§‹èƒŒæ™¯éŸ³ä¹ï¼ˆå¢å¼ºç§»åŠ¨ç«¯æ”¯æŒï¼‰
        function autoStartMusic() {
            if (!backgroundMusicPlaying) {
                // å»¶è¿Ÿå¼€å§‹ï¼Œå¹¶æ·»åŠ é¢å¤–çš„ç§»åŠ¨ç«¯æ£€æŸ¥
                setTimeout(() => {
                    // æ£€æŸ¥æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Š
                    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    
                    if (isMobile) {
                        // ç§»åŠ¨ç«¯æ˜¾ç¤ºæç¤ºï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨å¯åŠ¨
                        setTimeout(() => {
                            showMusicTip();
                        }, 2000);
                    } else {
                        // æ¡Œé¢ç«¯å°è¯•è‡ªåŠ¨æ’­æ”¾
                        toggleBackgroundMusic();
                    }
                }, 1500);
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            createBackgroundDecorations();
            updateProgress();
            
            // è‡ªåŠ¨å¼€å§‹ç¬¬äºŒé˜¶æ®µ
            setTimeout(() => {
                nextStage();
            }, 3000);
        });
        
        // åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡»æ—¶è‡ªåŠ¨å¼€å§‹èƒŒæ™¯éŸ³ä¹
        let userHasInteracted = false;
        
        document.addEventListener('click', function() {
            if (!userHasInteracted) {
                userHasInteracted = true;
                autoStartMusic();
            }
        });
        
        document.addEventListener('touchstart', function() {
            if (!userHasInteracted) {
                userHasInteracted = true;
                autoStartMusic();
            }
        });
        
        // é˜²æ­¢é¡µé¢ç¼©æ”¾
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        });
        
        // é˜²æ­¢åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showTip(message, duration = 2000) {
            const tip = document.createElement('div');
            tip.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-size: 16px;
                font-weight: 600;
                z-index: 10000;
                text-align: center;
                max-width: 90vw;
                animation: fadeIn 0.3s ease-in;
            `;
            tip.textContent = message;
            
            document.body.appendChild(tip);
            
            setTimeout(() => {
                tip.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => {
                    if (tip.parentNode) {
                        tip.parentNode.removeChild(tip);
                    }
                }, 300);
            }, duration);
        }
    </script>
</body>
</html> 